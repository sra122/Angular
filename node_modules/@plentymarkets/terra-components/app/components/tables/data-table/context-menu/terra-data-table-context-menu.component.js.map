{"version":3,"sources":["app/components/tables/data-table/context-menu/terra-data-table-context-menu.component.ts"],"names":[],"mappings":"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","file":"terra-data-table-context-menu.component.js","sourcesContent":["import { Component } from '@angular/core';\nimport { TerraDataTableContextMenuService } from './service/terra-data-table-context-menu.service';\nimport { TerraDataTableContextMenuEntryInterface } from './data/terra-data-table-context-menu-entry.interface';\nimport { TerraBaseData } from '../../../data/terra-base.data';\n\n/**\n * @author mkunze\n */\n@Component({\n    // tslint:disable-next-line\n    selector: 'context-menu', // it still exists a terra-context-menu in terra, need to refactored first\n    styles:   [require('./terra-data-table-context-menu.component.scss')],\n    template: require('./terra-data-table-context-menu.component.html')\n})\nexport class TerraDataTableContextMenuComponent<D extends TerraBaseData>\n{\n    protected contextMenuLinkList:Array<TerraDataTableContextMenuEntryInterface<D>> = [];\n    protected locationCss:any = {\n        visibility: 'hidden',\n        left:       0,\n        top:        0,\n        right:      0\n    };\n\n    private isShown:boolean = false;\n    private clickListener:(event:Event) => void;\n\n    private mouseLocation:{ left:number, top:number } = {\n        left: 0,\n        top:  0\n    };\n\n    constructor(private contextMenuService:TerraDataTableContextMenuService<D>)\n    {\n        contextMenuService.show.subscribe(\n            (e:any):void => this.showMenu(e.event, e.obj));\n\n        contextMenuService.init.subscribe(\n            (e:any):void => this.contextMenuLinkList = e\n        );\n\n        this.clickListener = (event:Event):void =>\n        {\n            this.clickedOutside();\n            event.stopPropagation();\n        };\n    }\n\n    public clickedOutside():void\n    {\n        this.isShown = false;\n        this.locationCss = this.calcMenuPosition();\n        document.removeEventListener('click', this.clickListener);\n    }\n\n    public showMenu(event:MouseEvent, contextMenuLinkList:Array<TerraDataTableContextMenuEntryInterface<D>>):void\n    {\n        this.isShown = true;\n        this.contextMenuLinkList = contextMenuLinkList;\n        this.mouseLocation = {\n            left: event.clientX,\n            top:  event.clientY\n        };\n\n        this.locationCss = this.calcMenuPosition();\n\n        event.stopPropagation();\n        document.addEventListener('click', this.clickListener);\n    }\n\n    private calcMenuPosition():{ visibility:string, left:string, top:string }\n    {\n        // 70 (navbar) + 46 (tabbar) + 36 (breadcrumbs)\n        let offsetTop:number = 108; // 161\n        let offsetLeft:number;\n        let anchor:JQuery = $('.context-menu#menu');\n        let isMenuAtBottom:boolean;\n        let contextMenuHeight:number = anchor.height();\n        let contextMenuWidth:number = anchor.width();\n        let tableWidth:number;\n\n        let buttomTop:string = this.mouseLocation.top - offsetTop - contextMenuHeight + 'px';\n        let top:string = this.mouseLocation.top - offsetTop - 2 + 'px';\n\n        if(this.mouseLocation.top + contextMenuHeight > innerHeight)\n        {\n            isMenuAtBottom = true;\n        }\n\n        let dataTableElement:JQuery = anchor.closest('terra-data-table');\n\n        offsetLeft = dataTableElement.offset().left;\n\n        tableWidth = dataTableElement.find('tbody').width();\n\n        if(Math.abs(this.mouseLocation.left - offsetLeft - 2) + contextMenuWidth > tableWidth)\n        {\n            offsetLeft = offsetLeft + contextMenuWidth - 6;\n        }\n\n        return {\n            visibility: this.isShown ? 'visible' : 'hidden',\n            left:       this.mouseLocation.left - offsetLeft - 2 + 'px',\n            top:        isMenuAtBottom ? buttomTop : top\n        };\n    }\n}\n"]}