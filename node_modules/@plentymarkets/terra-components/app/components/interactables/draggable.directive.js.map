{"version":3,"sources":["app/components/interactables/draggable.directive.ts"],"names":[],"mappings":"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","file":"draggable.directive.js","sourcesContent":["import {\n    Directive,\n    ElementRef,\n    EventEmitter,\n    Input,\n    OnChanges,\n    Output,\n    SimpleChanges\n} from '@angular/core';\nimport { GridOptions } from './gridOptions.interface';\nimport { DraggableOptions } from './draggableOptions.interface';\nimport { RestrictOptions } from './restrictOptions.interface';\nimport { InertiaOptions } from './inertiaOptions.interface';\nimport {\n    Interactable,\n    InteractEvent\n} from 'interactjs';\nimport interact = require('interactjs');\n\n@Directive({\n    selector: '[terraDraggable]'\n})\nexport class TerraDraggableDirective implements OnChanges\n{\n    @Input('terraDraggable')\n    public options?:DraggableOptions = null;\n\n    @Input('terra-draggable-disabled')\n    public disabled:boolean = false;\n\n    @Input('terra-draggable-grid')\n    public grid:GridOptions = null;\n\n    @Input('terra-draggable-restrict')\n    public restrict:RestrictOptions = null;\n\n    @Input('tera-draggable-inertia')\n    public inertia:boolean | InertiaOptions = false;\n\n    @Input('terra-draggable-data')\n    public dragData:any;\n\n    @Output('terra-draggable-onStart')\n    public onStart:EventEmitter<InteractEvent> = new EventEmitter<InteractEvent>();\n\n    @Output('terra-draggable-onMove')\n    public onMove:EventEmitter<InteractEvent> = new EventEmitter<InteractEvent>();\n\n    @Output('terra-draggable-onEnd')\n    public onEnd:EventEmitter<InteractEvent> = new EventEmitter<InteractEvent>();\n\n    private interactable:Interactable;\n\n    constructor(private el:ElementRef)\n    {\n        this.init();\n    }\n\n    public ngOnChanges(changes:SimpleChanges):void\n    {\n        Object.keys(changes).forEach((changedProperty:string) =>\n        {\n            if(typeof changes[changedProperty].currentValue === 'object')\n            {\n                this.prepareImmutableInput(changedProperty);\n            }\n        });\n\n        this.init();\n    }\n\n    private prepareImmutableInput(input:string):void\n    {\n        if(this[input] && typeof this[input] === 'object')\n        {\n            Object.keys(this[input])\n                  .filter((property:string) =>\n                  {\n                      return this[input].propertyIsEnumerable(property);\n                  })\n                  .forEach((property:string) =>\n                  {\n                      // this[input][\"_\" + property] = this[input][property];\n                      Object.defineProperty(\n                          this[input],\n                          '_' + property,\n                          {\n                              configurable: false,\n                              enumerable:   false,\n                              writable:     true,\n                              value:        this[input][property]\n                          }\n                      );\n\n                      Object.defineProperty(this[input], property,\n                          {\n                              configurable: true,\n                              enumerable:   true,\n                              get:          ():any =>\n                                            {\n                                                return this[input]['_' + property];\n                                            },\n                              set:          (value:any):void =>\n                                            {\n                                                this[input]['_' + property] = value;\n                                                this.init();\n                                            }\n                          }\n                      );\n\n                  });\n        }\n    }\n\n    private init():void\n    {\n        let draggableConfig:any = {\n            max:          (this.options || {}).max || 1,\n            maxPerElemet: (this.options || {}).maxPerElement || Infinity,\n            autoScroll:   (this.options || {}).autoScroll || false,\n            axis:         (this.options || {}).axis || 'xy',\n            manualStart:  (this.options || {}).manualStart || false,\n            inertia:      this.inertia,\n            enabled:      !this.disabled,\n            allowFrom:    (this.options || {}).allowFrom || null,\n            ignoreFrom:   (this.options || {}).ignoreFrom || null,\n            styleCursor:  false,\n            onstart:      (event:InteractEvent):void =>\n                          {\n                              this.onStart.emit(event);\n                              event.target.IA_DRAG_DATA = this.dragData;\n                          },\n            onmove:       (event:InteractEvent):void =>\n                          {\n                              this.onMove.emit(event);\n                              event.target.IA_DRAG_DATA = this.dragData;\n                          },\n            onend:        (event:InteractEvent):void =>\n                          {\n                              this.onEnd.emit(event);\n                              event.target.IA_DRAG_DATA = null;\n                          },\n        };\n\n        if(this.grid)\n        {\n            draggableConfig.snap = {\n                targets:        [\n                    (x:number, y:number):{ x:number, y:number, range:number } =>\n                    {\n                        return this.handleSnap(x, y);\n                    }\n                ],\n                endOnly:        this.grid && this.grid.endOnly,\n                relativePoints: this.grid.relativePoints\n            };\n        }\n\n        if(this.restrict)\n        {\n            draggableConfig.restrict = this.restrict;\n        }\n\n        if(!this.interactable)\n        {\n            this.interactable = interact(this.el.nativeElement);\n        }\n\n        this.interactable.draggable(draggableConfig);\n    }\n\n    private handleSnap(x:number, y:number):{ x:number, y:number, range:number }\n    {\n        if(this.grid)\n        {\n            let offset:{ x:number, y:number } = {\n                x: 0,\n                y: 0\n            };\n\n            if(this.grid.offset)\n            {\n                offset = this.grid.offset;\n            }\n\n            return {\n                x:     Math.round((x - offset.x) / this.grid.x) * this.grid.x,\n                y:     Math.round((y - offset.y) / this.grid.y) * this.grid.y,\n                range: (this.grid.range || Infinity)\n            };\n        }\n        else\n        {\n            // Snap is disabled\n            return {\n                x:     x,\n                y:     y,\n                range: 0\n            };\n        }\n    }\n}\n"]}