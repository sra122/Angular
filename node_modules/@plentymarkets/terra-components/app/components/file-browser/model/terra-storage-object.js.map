{"version":3,"sources":["app/components/file-browser/model/terra-storage-object.ts"],"names":[],"mappings":";;AAAA,6EAGuC;AACvC,6BAAyC;AACzC,4DAA0D;AAC1D,oEAAkE;AAElE;IAyHI,4BAAY,QAAiC,EAAE,MAA0B;QAtHjE,cAAS,GAA6B,EAAE,CAAC;QAwH7C,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACzB,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;IAC1B,CAAC;IAvHD,sBAAW,oCAAI;aAAf;YAEI,OAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC;QAC9B,CAAC;;;OAAA;IAED,sBAAW,mCAAG;aAAd;YAEI,OAAO,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC;QAC7B,CAAC;;;OAAA;IAED,sBAAW,yCAAS;aAApB;YAEI,OAAO,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC;QACnC,CAAC;;;OAAA;IAED,sBAAW,0CAAU;aAArB;YAEI,OAAO,IAAI,CAAC,QAAQ,CAAC,UAAU,IAAI,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC;QAC/D,CAAC;;;OAAA;IAED,sBAAW,4CAAY;aAAvB;YAEI,OAAO,IAAI,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC;QAChD,CAAC;;;OAAA;IAED,sBAAW,oCAAI;aAAf;YAEI,OAAO,QAAQ,CAAE,IAAI,CAAC,QAAQ,CAAC,IAAI,GAAG,EAAE,EAAE,EAAE,CAAE,CAAC;QACnD,CAAC;;;OAAA;IAED,sBAAW,0CAAU;aAArB;YAEI,IAAI,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,EACpB;gBACI,OAAO,IAAI,CAAC;aACf;YACD,OAAO,wBAAU,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC5C,CAAC;;;OAAA;IAED,sBAAW,oCAAI;aAAf;YAEI,OAAO,wBAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;QAClD,CAAC;;;OAAA;IAED,sBAAW,oCAAI;aAAf;YAEI,IAAG,IAAI,CAAC,WAAW,EACnB;gBACI,OAAO,aAAa,CAAC;aACxB;YAED,OAAO,gCAAc,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAClD,CAAC;;;OAAA;IAED,sBAAW,2CAAW;aAAtB;YAEI,OAAO,wBAAU,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;QACrD,CAAC;;;OAAA;IAED,sBAAW,sCAAM;aAAjB;YAEI,OAAO,wBAAU,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;QAChD,CAAC;;;OAAA;IAED,sBAAW,sCAAM;aAAjB;YAEI,OAAO,IAAI,CAAC,OAAO,CAAC;QACxB,CAAC;;;OAAA;IAED,sBAAW,2CAAW;aAAtB;YAEI,OAAO,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC;QAC3D,CAAC;;;OAAA;IAED,sBAAW,wCAAQ;aAAnB;YAEI,IAAG,IAAI,CAAC,MAAM,EACd;gBACI,OAAO,EAAE,CAAC;aACb;YAED,OAAO,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,UAAC,MAAyB,EAAE,MAAyB;gBAE5E,IAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,EAC5B;oBACI,OAAO,CAAC,CAAC,CAAC;iBACb;gBACD,IAAG,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,EAC5B;oBACI,OAAO,CAAC,CAAC;iBACZ;gBACD,OAAO,CAAC,CAAC;YACb,CAAC,CAAC,CAAC;QACP,CAAC;;;OAAA;IAED,sBAAW,yCAAS;aAApB;YAEI,IAAG,IAAI,CAAC,MAAM,EACd;gBACI,OAAO,CAAC,CAAC;aACZ;iBAED;gBACI,OAAO,IAAI,CAAC,QAAQ;qBACR,GAAG,CAAC,UAAC,KAAwB;oBAE1B,OAAO,KAAK,CAAC,SAAS,CAAC;gBAC3B,CAAC,CAAC;qBACD,MAAM,CAAC,UAAC,GAAU,EAAE,OAAc;oBAE/B,OAAO,GAAG,GAAG,OAAO,CAAC;gBACzB,CAAC,EAAE,CAAC,CAAC,CAAC;aACpB;QACL,CAAC;;;OAAA;IAQM,qCAAQ,GAAf,UAAgB,QAAiC,EAAE,KAAoB;QAEnE,IAAG,IAAI,CAAC,MAAM,EACd;YACI,OAAO,CAAC,KAAK,CAAC,8CAA8C,CAAC,CAAC;YAC9D,OAAO;SACV;QAED,KAAK,GAAG,KAAK,IAAI,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,wBAAU,CAAC,SAAS,CAAC,CAAC;QAC1D,OAAM,KAAK,CAAC,MAAM,GAAG,CAAC,IAAI,KAAK,CAAC,CAAC,CAAC,CAAC,MAAM,IAAI,CAAC,EAC9C;YACI,KAAK,CAAC,KAAK,EAAE,CAAC;SACjB;QAED,IAAI,OAAO,GAAU,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC;QACtC,OAAM,OAAO,GAAG,CAAC,IAAI,KAAK,CAAC,OAAO,CAAC,CAAC,MAAM,IAAI,CAAC,EAC/C;YACI,KAAK,CAAC,GAAG,EAAE,CAAC;YACZ,OAAO,EAAE,CAAC;SACb;QAED,IAAG,KAAK,CAAC,MAAM,KAAK,CAAC,EACrB;YACI,IAAI,QAAM,GAAsB,IAAI,kBAAkB,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;YACvE,IAAG,IAAI,CAAC,QAAQ,CAAC,QAAM,CAAC,IAAI,CAAC,EAC7B;gBACI,IAAI,GAAG,GAAU,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,UAAC,KAAwB;oBAE/D,OAAO,KAAK,CAAC,IAAI,KAAK,QAAM,CAAC,IAAI,CAAC;gBACtC,CAAC,CAAC,CAAC;gBACH,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,GAAG,QAAM,CAAC;aAChC;iBAED;gBACI,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAM,CAAC,CAAC;aAC/B;SACJ;aAED;YACI,IAAI,QAAQ,GAAU,KAAK,CAAC,KAAK,EAAE,CAAC;YACpC,IAAI,KAAK,GAAsB,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;YACvD,IAAG,CAAC,KAAK,EACT;gBACI,IAAI,QAAQ,GAA4B,mDAAqB,CACzD,wBAAU,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,QAAQ,CAAC,GAAG,GAAG,CAC5C,CAAC;gBACF,KAAK,GAAG,IAAI,kBAAkB,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;gBAC/C,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;aAC7B;YAED,KAAK,CAAC,QAAQ,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;SACnC;IACL,CAAC;IAEM,wCAAW,GAAlB,UAAmB,GAAU;QAEzB,IAAI,KAAK,GAAiB,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,CAAC;QACtD,IAAI,QAAQ,GAAU,KAAK,CAAC,KAAK,EAAE,CAAC;QACpC,IAAI,KAAK,GAAsB,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;QACvD,IAAG,KAAK,EACR;YACI,IAAG,KAAK,CAAC,MAAM,GAAG,CAAC,EACnB;gBACI,KAAK,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;aACtC;iBAED;gBACI,IAAI,GAAG,GAAU,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;gBAC/C,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;aACjC;SACJ;IACL,CAAC;IAEM,qCAAQ,GAAf,UAAgB,IAAW;QAEvB,OAAO,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,UAAC,KAAwB;YAEhD,OAAO,KAAK,CAAC,IAAI,KAAK,IAAI,CAAC;QAC/B,CAAC,CAAC,CAAC;IACP,CAAC;IAEM,qCAAQ,GAAf,UAAgB,IAAW;QAEvB,OAAO,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,UAAC,KAAwB;YAEhD,OAAO,KAAK,CAAC,IAAI,KAAK,IAAI,CAAC;QAC/B,CAAC,CAAC,CAAC;IACP,CAAC;IAEM,iCAAI,GAAX,UAAY,GAAU;QAElB,IAAG,wBAAiB,CAAC,GAAG,CAAC,EACzB;YACI,OAAO,IAAI,CAAC;SACf;QAED,IAAI,KAAK,GAAiB,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,CAAC;QACtD,IAAI,QAAQ,GAAU,KAAK,CAAC,KAAK,EAAE,CAAC;QACpC,IAAI,KAAK,GAAsB,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;QACvD,IAAG,CAAC,wBAAiB,CAAC,KAAK,CAAC,EAC5B;YACI,IAAG,KAAK,CAAC,MAAM,GAAG,CAAC,EACnB;gBACI,OAAO,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;aACtC;YAED,OAAO,KAAK,CAAC;SAChB;QAED,OAAO,IAAI,CAAC;IAChB,CAAC;IAEO,8CAAiB,GAAzB,UAA0B,GAAU;QAEhC,OAAO,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,UAAC,IAAW,IAAa,OAAA,IAAI,CAAC,MAAM,GAAG,CAAC,EAAf,CAAe,CAAC,CAAC;IAC3E,CAAC;IACL,yBAAC;AAAD,CAnPA,AAmPC,IAAA;AAnPY,gDAAkB","file":"terra-storage-object.js","sourcesContent":["import {\n    createS3StorageObject,\n    S3StorageObjectInterface\n} from './s3-storage-object.interface';\nimport { isNullOrUndefined } from 'util';\nimport { PathHelper } from '../../../helpers/path.helper';\nimport { FileTypeHelper } from '../../../helpers/fileType.helper';\n\nexport class TerraStorageObject\n{\n    private s3Object:S3StorageObjectInterface;\n    private _children:Array<TerraStorageObject> = [];\n    private _parent:TerraStorageObject;\n\n    public get eTag():string\n    {\n        return this.s3Object.eTag;\n    }\n\n    public get key():string\n    {\n        return this.s3Object.key;\n    }\n\n    public get publicUrl():string\n    {\n        return this.s3Object.publicUrl;\n    }\n\n    public get previewUrl():string\n    {\n        return this.s3Object.previewUrl || this.s3Object.publicUrl;\n    }\n\n    public get lastModified():Date\n    {\n        return new Date(this.s3Object.lastModified);\n    }\n\n    public get size():number\n    {\n        return parseInt( this.s3Object.size + '', 10 );\n    }\n\n    public get sizeString():string\n    {\n        if( isNaN(this.size) )\n        {\n            return '0B';\n        }\n        return PathHelper.sizeString(this.size);\n    }\n\n    public get name():string\n    {\n        return PathHelper.basename(this.s3Object.key);\n    }\n\n    public get icon():string\n    {\n        if(this.isDirectory)\n        {\n            return 'icon-folder';\n        }\n\n        return FileTypeHelper.mapIconClass(this.name);\n    }\n\n    public get isDirectory():boolean\n    {\n        return PathHelper.isDirectory(this.s3Object.key);\n    }\n\n    public get isFile():boolean\n    {\n        return PathHelper.isFile(this.s3Object.key);\n    }\n\n    public get parent():TerraStorageObject\n    {\n        return this._parent;\n    }\n\n    public get hasChildren():boolean\n    {\n        return this.isFile ? false : this._children.length > 0;\n    }\n\n    public get children():Array<TerraStorageObject>\n    {\n        if(this.isFile)\n        {\n            return [];\n        }\n\n        return this._children.sort((childA:TerraStorageObject, childB:TerraStorageObject) =>\n        {\n            if(childA.name > childB.name)\n            {\n                return -1;\n            }\n            if(childA.name < childB.name)\n            {\n                return 1;\n            }\n            return 0;\n        });\n    }\n\n    public get fileCount():number\n    {\n        if(this.isFile)\n        {\n            return 1;\n        }\n        else\n        {\n            return this.children\n                       .map((child:TerraStorageObject) =>\n                       {\n                           return child.fileCount;\n                       })\n                       .reduce((sum:number, current:number) =>\n                       {\n                           return sum + current;\n                       }, 0);\n        }\n    }\n\n    constructor(s3Object:S3StorageObjectInterface, parent?:TerraStorageObject)\n    {\n        this.s3Object = s3Object;\n        this._parent = parent;\n    }\n\n    public addChild(s3object:S3StorageObjectInterface, paths?:Array<string>):void\n    {\n        if(this.isFile)\n        {\n            console.error('Cannot add child object to file-like object.');\n            return;\n        }\n\n        paths = paths || s3object.key.split(PathHelper.DELIMITER);\n        while(paths.length > 0 && paths[0].length <= 0)\n        {\n            paths.shift();\n        }\n\n        let lastIdx:number = paths.length - 1;\n        while(lastIdx > 0 && paths[lastIdx].length <= 0)\n        {\n            paths.pop();\n            lastIdx--;\n        }\n\n        if(paths.length === 1)\n        {\n            let object:TerraStorageObject = new TerraStorageObject(s3object, this);\n            if(this.hasChild(object.name))\n            {\n                let idx:number = this._children.findIndex((child:TerraStorageObject) =>\n                {\n                    return child.name === object.name;\n                });\n                this._children[idx] = object;\n            }\n            else\n            {\n                this._children.push(object);\n            }\n        }\n        else\n        {\n            let nextPath:string = paths.shift();\n            let child:TerraStorageObject = this.getChild(nextPath);\n            if(!child)\n            {\n                let s3Object:S3StorageObjectInterface = createS3StorageObject(\n                    PathHelper.join(this.key, nextPath) + '/'\n                );\n                child = new TerraStorageObject(s3Object, this);\n                this.children.push(child);\n            }\n\n            child.addChild(s3object, paths);\n        }\n    }\n\n    public removeChild(key:string):void\n    {\n        let paths:Array<string> = this.splitKeyIntoPaths(key);\n        let nextPath:string = paths.shift();\n        let child:TerraStorageObject = this.getChild(nextPath);\n        if(child)\n        {\n            if(paths.length > 0)\n            {\n                child.removeChild(paths.join('/'));\n            }\n            else\n            {\n                let idx:number = this._children.indexOf(child);\n                this._children.splice(idx, 1);\n            }\n        }\n    }\n\n    public getChild(name:string):TerraStorageObject\n    {\n        return this._children.find((child:TerraStorageObject) =>\n        {\n            return child.name === name;\n        });\n    }\n\n    public hasChild(name:string):boolean\n    {\n        return this._children.some((child:TerraStorageObject) =>\n        {\n            return child.name === name;\n        });\n    }\n\n    public find(key:string):TerraStorageObject\n    {\n        if(isNullOrUndefined(key))\n        {\n            return null;\n        }\n\n        let paths:Array<string> = this.splitKeyIntoPaths(key);\n        let nextPath:string = paths.shift();\n        let child:TerraStorageObject = this.getChild(nextPath);\n        if(!isNullOrUndefined(child))\n        {\n            if(paths.length > 0)\n            {\n                return child.find(paths.join('/'));\n            }\n\n            return child;\n        }\n\n        return null;\n    }\n\n    private splitKeyIntoPaths(key:string):Array<string>\n    {\n        return key.split('/').filter((part:string):boolean => part.length > 0);\n    }\n}\n"]}